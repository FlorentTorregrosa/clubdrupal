#!/bin/sh
PATH=/usr/local/bin:/usr/bin:/bin

##############
# nlehuby - 2 décembre 2011
# ce script permet de changer le mot de passe de la base de données dans les fichiers settings.php de l'installation drupal 6 et drupal 7.
##############
#prend l’ancien et le nouveau mpd en paramètre
#drupal 6
cd /users/guest/assos/html/sites

for x in $(ls -1 | grep -v 'all'); do
	cd $x;
	fichier="settings.php"
	chmod 600 $fichier
	mv $fichier $fichier.old
	 #remplacer la première chaine après le / par l'ancien mot de passe, et la seconde chaine (après le deuxième /) par le nouveau mot de passe
	sed "s/$1/$2/g" < $fichier.old > $fichier
	chmod 400 $fichier
	echo "Verifier que le site fonctionne et appuyer sur la touche Entree pour continuer"
	read fake_variable
	rm $fichier.old
	cd ..
done
